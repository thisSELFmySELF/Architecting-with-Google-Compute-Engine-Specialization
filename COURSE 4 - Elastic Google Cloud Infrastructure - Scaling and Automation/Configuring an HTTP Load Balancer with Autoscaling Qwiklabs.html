
<!DOCTYPE html>
<html lang='en'>
<head>
<title>Configuring an HTTP Load Balancer with Autoscaling | Qwiklabs</title>
<meta name="action-cable-url" content="/cable" />
<script>
//<![CDATA[
window.gon={};gon.deployment="googlecoursera-run";
//]]>
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-5XSKHDX");
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-b1b28b59480cca2ab0c23485f64ba2ec8893bdc9.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-00b9f69ad908fc0b1976f728c833423441752435.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-990e13ea9ea264da0ab8ee25376a474b85237e1e.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-ea1f357188726febdc7b0d7c93ee94beed0f285a.js"></script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="/rE/vAvwl0iWquwcyJ6X00k862H9sY1SvUFtXhzTvxt74xTOY0fuCA0uKWeak1KE/lH29AjKHlUZx3DZiL9HbA==" />
<meta content='width=device-width, initial-scale=1.0, user-scalable=yes' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:0,&quot;variant&quot;:&quot;original&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:12197799,&quot;experimentIds&quot;:[&quot;barker&quot;,&quot;community_forum&quot;,&quot;enforce_codebuild_verdicts&quot;,&quot;used_in&quot;,&quot;content_provider_admin&quot;,&quot;program_announcements&quot;,&quot;organization_announcements&quot;,&quot;organization_learning_plans&quot;,&quot;course_upgrade&quot;,&quot;show_annual_purchase_now&quot;,&quot;oauth_risc_shutoff&quot;,&quot;program_learning_assignment&quot;,&quot;teams&quot;,&quot;peer_assignment&quot;,&quot;chat_off_for_signed_out_users&quot;,&quot;canonical_domain_redirect&quot;,&quot;alexandria_show_bundle_errors&quot;,&quot;search_updates&quot;]}' name='help-api-product-data'>
<meta content='{&quot;groupIds&quot;:[&quot;non_suadmins&quot;,&quot;students&quot;,&quot;non_organization&quot;,&quot;non_program&quot;]}' name='help-api-custom-data'>
<meta content='In this lab, you configure an HTTP Load Balancer. Then, you stress test the Load Balancer to demonstrate global load balancing and autoscaling.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Configuring an HTTP Load Balancer with Autoscaling | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='In this lab, you configure an HTTP Load Balancer. Then, you stress test the Load Balancer to demonstrate global load balancing and autoscaling.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<meta property="og:url" content="https://googlecoursera.qwiklabs.com/focuses/32666761?parent=lti_session" /><link href="https://googlecoursera.qwiklabs.com/focuses/32666761?parent=lti_session" rel="canonical" />
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>
<link href='/favicon-32.png' rel='shortcut icon' type='image/x-icon'>


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons|Google+Sans+Text:400,500,700" media="screen" />

<link rel="stylesheet" href="https://cdn.qwiklabs.com/assets/application-da73f1d12b824417d3fa2956c31a2f0cb210429a.css" media="all" />
<link rel="stylesheet" href="https://www.gstatic.com/glue/cookienotificationbar/cookienotificationbar.min.css" media="screen" />


<style>
  :root {
    --primary-text-on-surface-color: #1a73e8;
    --primary-text-on-surface-color-dark: #1568d6;
    --primary-text-on-surface-color-darker: #135ec1;
    --primary-text-on-surface-color-darkest: #1154ac;
    --primary-surface-color: #1a73e8;
    --primary-surface-color-rgb: 26,115,232;
    --primary-surface-color-light: #d1e3fa;
    --primary-surface-color-lightest: #e8f1fd;
    --text-on-primary-color: #ffffff;
    --accent-text-on-surface-color: #f29900;
    --accent-surface-color: #f9ab00;
    --accent-surface-color-rgb: 249,171,0;
    --accent-surface-color-light: #ffefcc;
    --text-on-accent-color: #202124;
  }
</style>



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<div class='header-container'>
<div class='header'>
<ql-toolbar jumpEnabled>
<div class='header__title' slot='title'>
<ql-icon-button label="Back" href="https://www.coursera.org/" id="9829b4475a952281" target="_self" tip="Back">arrow_back</ql-icon-button>
<h1 class='ql-title-medium'>Configuring an HTTP Load Balancer with Autoscaling</h1>
</div>
<div class='header__actions' slot='action'>
<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>
<ql-icon-button class='mobile-hide' icon='help_outline' id='help-menu-button' label='Open help menu' tip='Help'></ql-icon-button>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item data-analytics-action='opened_help' data-analytics-label='lab' label='Help Center' onclick='hallofmirrors.helpService.startHelp({&quot;productData&quot;:{&quot;userId&quot;:12197799},&quot;context&quot;:&quot;lab&quot;})'></ql-menu-item>
<ql-menu-item href='mailto:support@qwiklabs.com' label='Email support'></ql-menu-item>
<ql-menu-item label='Chat support' onClick='ql.chat.open()'></ql-menu-item>
</ql-menu>

<ql-icon-button class='mobile-hide' icon='language' id='language' label='Select your language preference' tip='Language'></ql-icon-button>
<ql-menu for='language'>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ar' href='/focuses/32666761?locale=ar&amp;parent=lti_session' label='العربية‬‎' lang='ar'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='de' href='/focuses/32666761?locale=de&amp;parent=lti_session' label='Deutsch' lang='de'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='en' href='/focuses/32666761?locale=en&amp;parent=lti_session' label='English' lang='en'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='es' href='/focuses/32666761?locale=es&amp;parent=lti_session' label='español (Latinoamérica)' lang='es'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr' href='/focuses/32666761?locale=fr&amp;parent=lti_session' label='français' lang='fr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr_CA' href='/focuses/32666761?locale=fr_CA&amp;parent=lti_session' label='français (Canada)' lang='fr-CA'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='he' href='/focuses/32666761?locale=he&amp;parent=lti_session' label='עברית' lang='he'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='id' href='/focuses/32666761?locale=id&amp;parent=lti_session' label='bahasa Indonesia' lang='id'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='it' href='/focuses/32666761?locale=it&amp;parent=lti_session' label='Italiano' lang='it'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ja' href='/focuses/32666761?locale=ja&amp;parent=lti_session' label='日本語' lang='ja'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ko' href='/focuses/32666761?locale=ko&amp;parent=lti_session' label='한국어' lang='ko'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pl' href='/focuses/32666761?locale=pl&amp;parent=lti_session' label='Polski' lang='pl'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_BR' href='/focuses/32666761?locale=pt_BR&amp;parent=lti_session' label='português (Brasil)' lang='pt-BR'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_PT' href='/focuses/32666761?locale=pt_PT&amp;parent=lti_session' label='português (Portugal)' lang='pt-PT'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ru' href='/focuses/32666761?locale=ru&amp;parent=lti_session' label='русский' lang='ru'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='tr' href='/focuses/32666761?locale=tr&amp;parent=lti_session' label='Türkçe' lang='tr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='uk' href='/focuses/32666761?locale=uk&amp;parent=lti_session' label='український' lang='uk'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh' href='/focuses/32666761?locale=zh&amp;parent=lti_session' label='简体中文' lang='zh'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh_TW' href='/focuses/32666761?locale=zh_TW&amp;parent=lti_session' label='繁體中文' lang='zh-TW'></ql-menu-item>
</ql-menu>


<ql-icon-button id='my_account' label='My account' tip='My account'>
<ql-avatar src='https://lh3.googleusercontent.com/a/ACg8ocI6s7UhNvX_oCOJMPhLJPmqhqIgwu_5AK0t7wpjF-5jmQo=s320-c'></ql-avatar>
</ql-icon-button>
<ql-menu for='my_account' id='my_account_menu' style='max-height: 640px'>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh3.googleusercontent.com/a/ACg8ocI6s7UhNvX_oCOJMPhLJPmqhqIgwu_5AK0t7wpjF-5jmQo=s320-c'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-title-medium'>Justin Ho</h4>
<p class='ql-body-medium text--light'>cliffdove@gmail.com</p>
<p class='ql-body-medium text--light'>
</p>
<a class="text--green ql-title-small" href="/my_account/payments"><ql-chip positive>
0 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a target="_blank" class="ql-label-medium text--light" href="/privacy_policy">Privacy</a>
<span class='ql-label-medium text--light l-mls l-mrs'>&middot;</span>
<a class="ql-label-medium text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</ql-toolbar>

</div>
</div>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class="custom-logo">Qwiklabs</div>
</div>
<nav class='ql-sidenav'>
<ql-sidenav-item href='/' icon='home' label='Home'></ql-sidenav-item>

<ql-sidenav-item href='/catalog' icon='school' label='Catalog'></ql-sidenav-item>

<ql-sidenav-item href='/profile' icon='event_note' label='Profile'></ql-sidenav-item>

</nav>

</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main' id='jump-content'>
<div class='l-main-wrapper' id='main-wrapper'>




<div class='lab-assessment__tab js-open-lab-assessment-panel'>
<button class='js-lab-assessment-total-score'>
27/30
</button>
</div>
<div aria-labelledby='lab-assessment-checkpoint' class='lab-assessment__panel js-lab-assessment-panel' role='dialog'>
<div class='lab-assessment__panel__header'>
<h4 id='lab-assessment-checkpoint'>Checkpoints</h4>
<ql-icon-button class='js-close-lab-assessment-panel' icon='arrow_forward' label='Close dialog'></ql-icon-button>
</div>
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Configure HTTP and health check firewall rules
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Configure HTTP and health check firewall rules' step_no='1'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
5
</span>
/ 5
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a NAT configuration using Cloud Router
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a NAT configuration using Cloud Router' step_no='2'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
5
</span>
/ 5
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a custom image for a web server
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a custom image for a web server' step_no='3'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-3'>
5
</span>
/ 5
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Configure an instance template and create instance groups
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Configure an instance template and create instance groups' step_no='4'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-4'>
5
</span>
/ 5
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Configure the HTTP load balancer
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Configure the HTTP load balancer' step_no='5'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-5'>
2
</span>
/ 5
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Stress test the HTTP load balancer
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Stress test the HTTP load balancer' step_no='6'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-6'>
5
</span>
/ 5
</p>
</div>
</div>

</div>
<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Configuring an HTTP Load Balancer with Autoscaling&quot;,&quot;lab_name&quot;:&quot;Configuring an HTTP Load Balancer with Autoscaling&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;googlecoursera-run&quot;}' data-credits='0.0' data-focus-id='32666761' data-lab-billing-limit='0.0' data-lab-duration='7200' data-lab-instance-id='83380852' data-parent='lti_session' data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:true}' labDetails='[{&quot;text&quot;:&quot;Open Google Cloud console&quot;,&quot;property&quot;:&quot;console_url&quot;,&quot;resource&quot;:&quot;project_0&quot;,&quot;href&quot;:&quot;https://accounts.google.com/AddSession?service=accountsettings\u0026sarp=1\u0026continue=https%3A%2F%2Fconsole.cloud.google.com%2Fhome%2Fdashboard%3Fproject%3Dqwiklabs-gcp-00-c57f8e99129a#Email=student-00-e64f76c0a9a5@qwiklabs.net&quot;,&quot;type&quot;:&quot;button&quot;},{&quot;label&quot;:&quot;Username&quot;,&quot;property&quot;:&quot;username&quot;,&quot;resource&quot;:&quot;user_0&quot;,&quot;value&quot;:&quot;student-00-e64f76c0a9a5@qwiklabs.net&quot;,&quot;type&quot;:&quot;credential&quot;},{&quot;label&quot;:&quot;Password&quot;,&quot;property&quot;:&quot;password&quot;,&quot;resource&quot;:&quot;user_0&quot;,&quot;value&quot;:&quot;hokRqMAxVq2e&quot;,&quot;type&quot;:&quot;credential&quot;},{&quot;label&quot;:&quot;GCP Project ID&quot;,&quot;property&quot;:&quot;project_id&quot;,&quot;resource&quot;:&quot;project_0&quot;,&quot;value&quot;:&quot;qwiklabs-gcp-00-c57f8e99129a&quot;,&quot;type&quot;:&quot;credential&quot;}]' labTimer='{&quot;ticking&quot;:true,&quot;secondsRemaining&quot;:4675}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
             grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                  var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
          var element = document.getElementById(id);
          if (element !== null) element.value = token;
        }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div aria-live='polite' class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='lab-content-container'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message' role='alert'></p>
<ql-icon-button class='alert__close js-alert-close' icon='clear'></ql-icon-button>
<iframe class='l-ie-iframe-fix' tabindex='-1'></iframe>
</div>
<div class='lab-content__renderable-instructions js-lab-content'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Configuring an HTTP Load Balancer with Autoscaling
</h1>
<div class='lab-preamble__details ql-title-medium'>
<span>2 hours</span>
<span>Free</span>
<div class='lab__rating'>
<a aria-label="Lab Reviews" href="/focuses/32666761/reviews?parent=lti_session"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.2506'></div>

</a></div>
</div>
</div>
<div class='lab-outline-place-holder'></div>

<div class='markdown-lab-instructions js-markdown-instructions' id='markdown-lab-instructions'>

<h2 id="step1">Overview</h2>
<p>Google Cloud HTTP(S) load balancing is implemented at the edge of Google's network in Google's points of presence (POP) around the world. User traffic directed to an HTTP(S) load balancer enters the POP closest to the user and is then load-balanced over Google's global network to the closest backend that has sufficient available capacity.</p>
<p>In this lab, you configure an HTTP load balancer as shown in the diagram below. Then, you stress test the load balancer to demonstrate global load balancing and autoscaling.</p>
<p><img alt="Network diagram" src="https://cdn.qwiklabs.com/ByFMJpAyU9Uxc4dL8LmHWdITVL%2BMvDA0eqOm1W63BSA%3D"></p>
<h3>Objectives</h3>
<p>In this lab, you learn how to perform the following tasks:</p>
<ul>
<li>Create a health check firewall rule</li>
<li>Create a NAT configuration using Cloud Router</li>
<li>Create a custom image for a web server</li>
<li>Create an instance template based on the custom image</li>
<li>Create two managed instance groups</li>
<li>Configure an HTTP load balancer with IPv4 and IPv6</li>
<li>Stress test an HTTP load balancer</li>
</ul>
<p>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</p>
<ol>
<li>
<p>Sign in to Qwiklabs using an <strong>incognito window</strong>.</p>
</li>
<li>
<p>Note the lab's access time (for example, <code>1:15:00</code>), and make sure you can finish within that time.<br>
There is no pause feature. You can restart if needed, but you have to start at the beginning.</p>
</li>
<li>
<p>When ready, click <strong>Start lab</strong>.</p>
</li>
<li>
<p>Note your lab credentials (<strong>Username</strong> and <strong>Password</strong>). You will use them to sign in to the Google Cloud Console.</p>
</li>
<li>
<p>Click <strong>Open Google Console</strong>.</p>
</li>
<li>
<p>Click <strong>Use another account</strong> and copy/paste credentials for <strong>this</strong> lab into the prompts.<br>
If you use other credentials, you'll receive errors or <strong>incur charges</strong>.</p>
</li>
<li>
<p>Accept the terms and skip the recovery resource page.</p>
</li>
</ol>
<aside class="warning"><p><strong>Note:</strong> Do not click <strong>End Lab</strong> unless you have finished the lab or want to restart it. This clears your work and removes the project.
  </p>
</aside>
<h2 id="step2">Task 1. Configure a health check firewall rule</h2>
<p>Health checks determine which instances of a load balancer can receive new connections. For HTTP load balancing, the health check probes to your load-balanced instances come from addresses in the ranges <b>130.211.0.0/22</b> and <b>35.191.0.0/16</b>. Your firewall rules must allow these connections.</p>
<h3>Create the health check rule</h3>
<p>Create a firewall rule to allow health checks.</p>
<ol>
<li>
<p>In the Cloud Console, on the  <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>VPC network</strong> &gt; <strong>Firewall</strong>.<br>
Notice the existing <strong>ICMP</strong>, <strong>internal</strong>, <strong>RDP</strong>, and <strong>SSH</strong> firewall rules.</p>
<p>Each Google Cloud project starts with the <strong>default</strong> network and these firewall rules.</p>
</li>
<li>
<p>Click <strong>Create Firewall Rule</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>fw-allow-health-checks</td>
</tr>
<tr>
<td>Network</td>
<td>default</td>
</tr>
<tr>
<td>Targets</td>
<td>Specified target tags</td>
</tr>
<tr>
<td>Target tags</td>
<td>allow-health-checks</td>
</tr>
<tr>
<td>Source filter</td>
<td>IPv4 ranges</td>
</tr>
<tr>
<td>Source IPv4 ranges</td>
<td>130.211.0.0/22 and 35.191.0.0/16</td>
</tr>
<tr>
<td>Protocols and ports</td>
<td>Specified protocols and ports</td>
</tr>

</table>
</li>
</ol>
<ql-infobox><strong>Note: </strong>Make sure to include the <strong>/22 </strong> and <strong>/16 </strong>  in the <strong>Source IP ranges</strong>.
</ql-infobox>
<ol start="4">
<li>Select <strong>tcp</strong> and specify port <strong>80</strong>.</li>
<li>Click <strong>Create</strong>.</li>
</ol>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="1">
Configure health check firewall rule
</ql-activity-tracking></p>
<h2 id="step3">Task 2. Create a NAT configuration using Cloud Router</h2>
<p>The Google Cloud VM backend instances that you set up in Task 3 will not be configured with external IP addresses.</p>
<p>Instead, you will set up the Cloud NAT service to allow these VM instances to send outbound traffic only through the Cloud NAT, and receive inbound traffic through the load balancer.</p>
<h3>Create the Cloud Router instance</h3>
<ol>
<li>
<p>In the Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>Network services</strong> &gt; <strong>Cloud NAT</strong>.</p>
</li>
<li>
<p>Click <strong>Get started</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Gateway name</td>
<td>nat-config</td>
</tr>
<tr>
<td>Network</td>
<td>default</td>
</tr>
<tr>
<td>Region</td>
<td><ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable></td>
</tr>

</table>
</li>
<li>
<p>Click <strong>Cloud Router</strong>, and select <strong>Create new router</strong>.</p>
</li>
<li>
<p>For <strong>Name</strong>, type <strong>nat-router-us1</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>In Create a NAT gateway, click <strong>Create</strong>.</p>
</li>
</ol>
<ql-infobox><strong>Note: </strong>Wait until the NAT Gateway Status changes to Running before moving onto the next task.
</ql-infobox>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="2">
Create a NAT configuration using Cloud Router
</ql-activity-tracking></p>
<h2 id="step4">Task 3. Create a custom image for a web server</h2>
<p>Create a custom web server image for the backend of the load balancer.</p>
<h3>Create a VM</h3>
<ol>
<li>
<p>In the Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>Compute Engine</strong> &gt; <strong>VM instances</strong>.</p>
</li>
<li>
<p>Click <strong>Create Instance</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>webserver</td>
</tr>
<tr>
<td>Region</td>
<td><ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable></td>
</tr>
<tr>
<td>Zone</td>
<td><ql-variable key="project_0.default_zone" placeholder="&lt;filled in at lab start&gt;"></ql-variable></td>
</tr>

</table>
</li>
<li>
<p>Under <strong>Boot disk</strong>, click <strong>Change</strong> and  for <strong>Version</strong>, select <code>Debian GNU/Linux 10 (buster)</code>.</p>
</li>
<li>
<p>Click <strong>Show Advanced Configuration</strong> and for <strong>Deletion rule</strong>, select <strong>Keep boot disk</strong>.</p>
</li>
<li>
<p>Click <strong>Select</strong>.</p>
</li>
<li>
<p>Click <strong>Networking, Disks, Security, Management, Sole-tenancy</strong>.</p>
</li>
<li>
<p>Click <strong>Networking</strong>.</p>
<ul>
<li>For <strong>Network tags</strong>, type <strong>allow-health-checks</strong>.</li>
<li>Under <strong>Network interfaces</strong> , click <strong>default</strong>.</li>
<li>Under <strong>External IPv4 IP</strong> dropdown, select <strong>None</strong>.</li>
</ul>
</li>
<li>
<p>Click <strong>Done</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
<h3>Customize the VM</h3>
<ol>
<li>For <strong>webserver</strong>, click <strong>SSH</strong> to launch a terminal and connect.</li>
<li>If you see the <strong>Connection via Cloud Identity-Aware Proxy Failed</strong> popup, click <strong>Retry</strong>.</li>
<li>To install Apache2, run the following commands:</li>
</ol>
<ql-code-block language="plaintext">
sudo apt-get update
sudo apt-get install -y apache2
</ql-code-block>
<ol start="4">
<li>To start the Apache server, run the following command:</li>
</ol>
<ql-code-block language="plaintext">
sudo service apache2 start
</ql-code-block>
<ol start="5">
<li>To test the default page for the Apache2 server, run the following command:</li>
</ol>
<ql-code-block language="plaintext">
curl localhost
</ql-code-block>
<p>The default page for the Apache2 server should be displayed.</p>
<h3>Set the Apache service to start at boot</h3>
<p>The software installation was successful. However, when a new VM is created using this image, the freshly booted VM does not have the Apache web server running. Use the following command to set the Apache service to automatically start on boot. Then test it to make sure it works.</p>
<ol>
<li>In the webserver SSH terminal, set the service to start on boot:</li>
</ol>
<ql-code-block language="plaintext">
sudo update-rc.d apache2 enable
</ql-code-block>
<ol start="2">
<li>
<p>In the Cloud Console, select <strong>webserver</strong>, and then click <strong>More actions</strong> <img alt="moreoptions.png" src="https://cdn.qwiklabs.com/3TiyfyCT%2F0FPozvdrtFUVIIx4mnoMgoPTov6GlwTwzs%3D"> .</p>
</li>
<li>
<p>Click <strong>Reset</strong>.</p>
</li>
<li>
<p>In the confirmation dialog, click <strong>Reset</strong>.</p>
</li>
</ol>
<ql-infobox><strong>Note: </strong>Reset will stop and reboot the machine. It keeps the same IPs and the same persistent boot disk, but memory is wiped. Therefore, if the Apache service is available after the reset, the <b>update-rc</b> command was successful.
</ql-infobox>
<ol start="5">
<li>Check the server by connecting via SSH to the VM and entering the following command:</li>
</ol>
<ql-code-block language="plaintext">
sudo service apache2 status
</ql-code-block>
<ql-warningbox><strong>Note:</strong> If you see the <strong>Connection via Cloud Identity-Aware Proxy Failed</strong> popup, click <strong>Retry</strong>.</ql-warningbox>
<ol start="6">
<li>The result should show <strong>Started The Apache HTTP Server</strong>.</li>
</ol>
<h3>Prepare the disk to create a custom image</h3>
<p>Verify that the boot disk will not be deleted when the instance is deleted.</p>
<ol>
<li>On the VM instances page, click <strong>webserver</strong> to view the VM instance details.</li>
<li>Under <strong>Storage</strong> &gt; <strong>Boot disk</strong>, verify that <strong>When deleting instance</strong> is set to <strong>Keep disk</strong>.</li>
<li>Return to the VM instances page, select <strong>webserver</strong>, and then click <strong>More actions</strong> (<img alt="More actions icon" src="https://cdn.qwiklabs.com/3TiyfyCT%2F0FPozvdrtFUVIIx4mnoMgoPTov6GlwTwzs%3D">) .</li>
<li>Click <strong>Delete.</strong>
</li>
<li>In the confirmation dialog, click <strong>Delete</strong>.</li>
<li>In the left pane, click <strong>Disks</strong> and verify that the <strong>webserver</strong> disk exists.</li>
</ol>
<h3>Create the custom image</h3>
<ol>
<li>
<p>In the left pane, click <strong>Images</strong>.</p>
</li>
<li>
<p>Click <strong>Create image</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>mywebserver</td>
</tr>
<tr>
<td>Source</td>
<td>Disk</td>
</tr>
<tr>
<td>Source disk</td>
<td>webserver</td>
</tr>

</table>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
<ql-infobox><strong>Note: </strong>You have created a custom image that multiple identical webservers can be started from. At this point, you could delete the <b>webserver</b> disk.
</ql-infobox>
<p>The next step is to use that image to define an instance template that can be used in the managed instance groups.</p>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="3">
Create a custom image for a web server
</ql-activity-tracking></p>
<h2 id="step5">Task 4. Configure an instance template and create instance groups</h2>
<p>A managed instance group uses an instance template to create a group of identical instances. Use these to create the backends of the HTTP load balancer.</p>
<h3>Configure the instance template</h3>
<p>An instance template is an API resource that you can use to create VM instances and managed instance groups. Instance templates define the machine type, boot disk image, subnet, labels, and other instance properties.</p>
<ol>
<li>In the Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>Compute Engine</strong> &gt; <strong>Instance templates</strong>.</li>
<li>Click <strong>Create Instance Template</strong>.</li>
<li>For <strong>Name</strong>, type <strong>mywebserver-template</strong>.</li>
<li>For <strong>Series</strong>, select <strong>E2</strong>.</li>
<li>For <strong>Machine type</strong>, select <strong>e2-micro (2 vCPU)</strong>.</li>
<li>For <strong>Boot disk</strong>, click <strong>Change</strong>.</li>
<li>Click  <strong>Custom images</strong>, for <strong>Source project for images</strong> make sure that Qwiklabs project ID is selected.</li>
<li>For <strong>Image</strong>, Select <strong>mywebserver</strong>.</li>
<li>Click <strong>Select</strong>.</li>
<li>Click <strong>Networking, Disks, Security, Management, Sole-tenancy</strong>.</li>
<li>Click <strong>Networking</strong>.
<ul>
<li>For <strong>Network tags</strong>, type <strong>allow-health-checks</strong>.</li>
<li>Under <strong>Network interfaces</strong> , click <strong>default</strong>.</li>
<li>Under <strong>External IPv4 IP</strong> dropdown, select <strong>None</strong>.</li>
<li>Click <strong>Done</strong>.</li>
</ul>
</li>
<li>Click <strong>Create</strong>.</li>
</ol>
<h3><strong>Create the health check for managed instance groups</strong></h3>
<ol>
<li>
<p>On the <strong>Navigation menu</strong>, click <strong>Compute Engine</strong> &gt; <strong>Health checks</strong>.</p>
</li>
<li>
<p>Click <strong>Create health check</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>http-health-check</td>
</tr>
<tr>
<td>Protocol</td>
<td>TCP</td>
</tr>
<tr>
<td>Port</td>
<td>80</td>
</tr>

</table>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
<ql-infobox>Managed instance group health checks proactively signal to delete and recreate instances that become unhealthy.</ql-infobox>
<h3>Create the managed instance groups</h3>
<p>Create a managed instance group in <strong><ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable></strong> and one in <ql-variable key="project_0.startup_script.selected_region" placeholder="REGION"></ql-variable>..</p>
<ol>
<li>
<p>On the <strong>Navigation menu</strong>, click <strong>Compute Engine</strong> &gt; <strong>Instance groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create Instance Group</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>us-1-mig</td>
</tr>
<tr>
<td>Instance template</td>
<td>mywebserver-template</td>
</tr>
<tr>
<td>Location</td>
<td>Multiple zones</td>
</tr>
<tr>
<td>Region</td>
<td><ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable></td>
</tr>

</table>
</li>
<li>
<p>Under <strong>Autoscaling</strong>, enter Minimum number of instances <code>1</code> and Maximum number of instances <code>2</code>.</p>
</li>
<li>
<p>Under <strong>Autoscaling signals</strong>, click on the <strong>CPU utilization</strong>.</p>
</li>
<li>
<p>Under <strong>Signal type</strong>, select <strong>HTTP load balancing utilization</strong>.</p>
</li>
<li>
<p>Enter Target HTTP load balancing utilization to <code>80</code>.</p>
</li>
<li>
<p>Click <strong>Done</strong>.</p>
</li>
<li>
<p>Click <strong>Initialization period</strong> and set to <code>60</code> seconds.</p>
</li>
</ol>
<ql-infobox><strong>Note: </strong>Managed instance groups offer <b>autoscaling</b> capabilities that allow you to automatically add or remove instances from a managed instance group based on increases or decreases in load. Autoscaling helps your applications gracefully handle increases in traffic and reduces cost when the need for resources is lower. You just define the autoscaling policy, and the autoscaler performs automatic scaling based on the measured load.
</ql-infobox>
<ol start="10">
<li>
<p>In <strong>Autohealing</strong>, for <strong>health check</strong> type <code>http-health-check</code></p>
</li>
<li>
<p>Select <code>http-health-check (TCP)</code></p>
</li>
<li>
<p>For <strong>Initial delay</strong>, type <code>60</code>.
This is how long the Instance Group waits after initializing the boot-up of a VM before it tries a health check. You don't want to wait 5 minutes for this during the lab, so you set it to 1 minute.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Click <strong>Confirm</strong> in the dialog window.</p>
</li>
</ol>
<ql-infobox><strong>Note:</strong> Wait a few minutes for the Instance Group to be created before repeating the same procedure for <strong>europe-1-mig</strong> in <strong><ql-variable key="project_0.startup_script.selected_region" placeholder="REGION"></ql-variable></strong> Click <strong> Refresh</strong> until the Status changes to <strong>Transforming. </strong> </ql-infobox>
<ql-warningbox><strong>Note:</strong> If a warning window appears,  or you see a red exclamation mark to the left of the instance group after creation stating <strong>There is no backend service attached to the instance group</strong>. Ignore this; you will configure the load balancer with a backend service in the next section of the lab.</ql-warningbox>
<ol start="15">
<li>
<p>Click <strong>Create Instance Group</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>europe-1-mig</td>
</tr>
<tr>
<td>Instance template</td>
<td>mywebserver-template</td>
</tr>
<tr>
<td>Location</td>
<td>Multiple zones</td>
</tr>
<tr>
<td>Region</td>
<td><ql-variable key="project_0.startup_script.selected_region" placeholder="REGION"></ql-variable></td>
</tr>
<tr>
<td>Autoscaling &gt; Minimum number of instances</td>
<td>1</td>
</tr>
<tr>
<td>Autoscaling &gt; Maximum number of instances</td>
<td>2</td>
</tr>
<tr>
<td>Autoscaling signals &gt; Signal Type</td>
<td>HTTP load balancing utilization</td>
</tr>
<tr>
<td>Target HTTP load balancing utilization</td>
<td>80</td>
</tr>
<tr>
<td>initialization period</td>
<td>60</td>
</tr>

</table>
</li>
<li>
<p>For <strong>Health check</strong>, select <strong>http-health-check (TCP)</strong>.</p>
</li>
<li>
<p>For <strong>Initial delay</strong>, type <code>60</code>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Click <strong>Confirm</strong> in the dialog window.</p>
</li>
</ol>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="4">
Configure an instance template and create instance groups
</ql-activity-tracking></p>
<h3>Verify the backends</h3>
<p>Verify that VM instances are being created in both regions.</p>
<ul>
<li>On the <strong>Navigation menu</strong>, click <strong>Compute Engine</strong> &gt; <strong>VM instances</strong>.<br>
Notice the instances that start with <i>us-1-mig</i> and <i>europe-1-mig</i>. These instances are part of the managed instance groups.</li>
</ul>
<h2 id="step6">Task 5. Configure the HTTP load balancer</h2>
<p>Configure the HTTP load balancer to balance traffic between the two backends (<strong>us-1-mig</strong> in <ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable> and <strong>europe-1-mig</strong> in <ql-variable key="project_0.startup_script.selected_region" placeholder="REGION"></ql-variable>) as illustrated in the network diagram:</p>
<p><img alt="Network diagram" src="https://cdn.qwiklabs.com/ByFMJpAyU9Uxc4dL8LmHWdITVL%2BMvDA0eqOm1W63BSA%3D"></p>
<h3>Start the configuration</h3>
<ol>
<li>On the <strong>Navigation menu</strong>, click <strong>Network Services</strong> &gt; <strong>Load balancing</strong>.</li>
<li>Click <strong>Create Load Balancer</strong>.</li>
<li>Under <strong>Application Load Balancer (HTTP/S)</strong>, click <strong>Start configuration</strong>.</li>
<li>Under <strong>Internet facing or internal only</strong>, select <strong>From Internet to my VMs or serverless services</strong>.</li>
<li>Under <strong>Global or Regional</strong>, select <strong>Global external Application Load Balancer</strong>.</li>
<li>Click <strong>Continue</strong>.</li>
<li>For <strong>Name</strong>, type <strong>http-lb</strong>.</li>
</ol>
<h3><strong>Configure the frontend</strong></h3>
<p>The host and path rules determine how your traffic will be directed. For example, you could direct video traffic to one backend and direct static traffic to another backend. However, you are not configuring the host and path rules in this lab.</p>
<ol>
<li>
<p>Click <strong>Frontend configuration</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Protocol</td>
<td>HTTP</td>
</tr>
<tr>
<td>IP version</td>
<td>IPv4</td>
</tr>
<tr>
<td>IP address</td>
<td>Ephemeral</td>
</tr>
<tr>
<td>Port</td>
<td>80</td>
</tr>

</table>
</li>
<li>
<p>Click <strong>Done</strong>.</p>
</li>
<li>
<p>Click <strong>Add Frontend IP and Port</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Protocol</td>
<td>HTTP</td>
</tr>
<tr>
<td>IP version</td>
<td>IPv6</td>
</tr>
<tr>
<td>IP address</td>
<td>Auto-allocate</td>
</tr>
<tr>
<td>Port</td>
<td>80</td>
</tr>

</table>
</li>
<li>
<p>Click <strong>Done</strong>.</p>
</li>
</ol>
<ql-infobox>HTTP(S) load balancing supports both IPv4 and IPv6 addresses for client traffic. Client IPv6 requests are terminated at the global load balancing layer and then proxied over IPv4 to your backends.</ql-infobox>
<h3>Configure the backend</h3>
<p>Backend services direct incoming traffic to one or more attached backends. Each backend is composed of an instance group and additional serving capacity metadata.</p>
<ol>
<li>
<p>Click <strong>Backend Configuration</strong>.</p>
</li>
<li>
<p>Click <strong>Backend services &amp; backend buckets</strong> &gt; <strong>Create a Backend Service</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>http-backend</td>
</tr>
<tr>
<td>Backend type</td>
<td>Instance group</td>
</tr>
<tr>
<td>Instance group</td>
<td>us-1-mig</td>
</tr>
<tr>
<td>Port numbers</td>
<td>80</td>
</tr>
<tr>
<td>Balancing mode</td>
<td>Rate</td>
</tr>
<tr>
<td>Maximum RPS</td>
<td>50</td>
</tr>
<tr>
<td>Capacity</td>
<td>100</td>
</tr>

</table>
</li>
</ol>
<ql-infobox><strong>Note: </strong>This configuration means that the load balancer attempts to keep each instance of <b>us-1-mig</b> at or below 50 requests per second (RPS).
</ql-infobox>
<ol start="4">
<li>
<p>Click <strong>Done</strong>.</p>
</li>
<li>
<p>Click <strong>Add Backend</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (select option as specified)</th>
</tr>


<tr>
<td>Instance group</td>
<td>europe-1-mig</td>
</tr>
<tr>
<td>Port numbers</td>
<td>80</td>
</tr>
<tr>
<td>Balancing mode</td>
<td>Utilization</td>
</tr>
<tr>
<td>Maximum backend utilization</td>
<td>80</td>
</tr>
<tr>
<td>Capacity</td>
<td>100</td>
</tr>

</table>
</li>
</ol>
<ql-infobox><strong>Note: </strong>This configuration means that the load balancer attempts to keep each instance of <b>europe-1-mig</b> at or below 80% CPU utilization.
</ql-infobox>
<ol start="7">
<li>Click <strong>Done</strong>.</li>
<li>For <strong>Health Check</strong>, select <strong>http-health-check</strong>.</li>
<li>Click check for the <strong>Enable logging</strong> checkbox.</li>
<li>Specify <strong>Sample rate</strong> as <code>1</code>.</li>
<li>Click <strong>Create</strong>.</li>
<li>Click <strong>OK</strong>.</li>
</ol>
<h3>Review and create the HTTP load balancer</h3>
<ol>
<li>Click <strong>Review and finalize</strong>.</li>
<li>Review the <strong>Backend services</strong> and <strong>Frontend</strong>.</li>
<li>Click <strong>Create</strong>. Wait for the load balancer to be created.</li>
<li>Click on the name of the load balancer (<strong>http-lb</strong>).</li>
<li>Note the IPv4 and IPv6 addresses of the load balancer for the next task. They will be referred to as <code>[LB_IP_v4]</code> and <code>[LB_IP_v6]</code>, respectively.</li>
</ol>
<ql-infobox><strong>Note: </strong>The IPv6 address is the one in hexadecimal format.
</ql-infobox>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="5">
Configure the HTTP load balancer
</ql-activity-tracking></p>
<h2 id="step7">Task 6. Stress test the HTTP load balancer</h2>
<p>Now that you have created the HTTP load balancer for your backends, it is time to verify that traffic is forwarded to the backend service.</p>
<p><ql-true-false-probe answer="true" stem="The HTTP load balancer should forward traffic to the region that is closest to you.">
</ql-true-false-probe></p>
<h3>Access the HTTP load balancer</h3>
<ol>
<li>On the Google Cloud Console title bar, click <strong>Activate Cloud Shell</strong> (<img alt="Activate Cloud Shell icon" src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D">).</li>
<li>If prompted, click <strong>Continue</strong>.</li>
<li>To check the status of the load balancer, run the following command, replace <strong>[LB_IP_v4]</strong> with the IPv4 address of the load balancer:</li>
</ol>
<ql-code-block language="bash">
LB_IP=[LB_IP_v4]
while [ -z "$RESULT" ] ;
do
  echo "Waiting for Load Balancer";
  sleep 5;
  RESULT=$(curl -m1 -s $LB_IP | grep Apache);
done
</ql-code-block>
<ql-infobox><strong>Note: </strong>Once the load balancer is ready, the command will exit.</ql-infobox>
<ol start="4">
<li>Open a new tab in your browser and navigate to <code>http://[LB_IP_v4]</code>. Make sure to replace <code>[LB_IP_v4]</code> with the IPv4 address of the load balancer.</li>
</ol>
<h3>Stress test the HTTP load balancer</h3>
<p>Create a new VM to simulate a load on the HTTP load balancer. Then determine whether traffic is balanced across both backends when the load is high.</p>
<ol>
<li>
<p>In the Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>Compute Engine</strong> &gt; <strong>VM instances</strong>.</p>
</li>
<li>
<p>Click <strong>Create instance</strong>.</p>
</li>
<li>
<p>Specify the following, and leave the remaining settings as their defaults:</p>
<table>

<tr>
<th>Property</th>
<th>Value (type value or select option as specified)</th>
</tr>


<tr>
<td>Name</td>
<td>stress-test</td>
</tr>
<tr>
<td>Region</td>
<td>A region different but closer to <ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable>
</td>
</tr>
<tr>
<td>Zone</td>
<td>A zone from the region</td>
</tr>
<tr>
<td>Series</td>
<td>E2</td>
</tr>
<tr>
<td>Machine type</td>
<td>e2-micro (2 vCPU)</td>
</tr>

</table>
</li>
</ol>
<ql-infobox><strong>Note: </strong>Because a region in US is closer to <ql-variable key="project_0.default_region" placeholder="&lt;filled in at lab start&gt;"></ql-variable> than to <b>europe-1</b>, traffic should be forwarded only to <b>us-1-mig</b> (unless the load is too high).</ql-infobox>
<ol start="4">
<li>
<p>For <strong>Boot Disk</strong>, click <strong>Change</strong>.</p>
</li>
<li>
<p>Click  <strong>Custom images</strong>, for <strong>Source project for images</strong> make sure that Qwiklabs project ID is selected.</p>
</li>
<li>
<p>For <strong>Image</strong>, select <strong>mywebserver</strong>.</p>
</li>
<li>
<p>Click <strong>Select</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.<br>
Wait for the <strong>stress-test</strong> instance to be created.</p>
</li>
<li>
<p>For <strong>stress-test</strong>, click <strong>SSH</strong> to launch a terminal and connect.</p>
</li>
<li>
<p>To create an environment variable for your load balancer IP address, run the following command:</p>
</li>
</ol>
<ql-code-block language="plaintext">
export LB_IP=&lt;Enter your [LB_IP_v4] here&gt;
</ql-code-block>
<ol start="11">
<li>Verify it with echo:</li>
</ol>
<ql-code-block language="plaintext">
echo $LB_IP
</ql-code-block>
<ol start="12">
<li>To place a load on the load balancer, run the following command:</li>
</ol>
<ql-code-block language="plaintext">
ab -n 500000 -c 1000 http://$LB_IP/
</ql-code-block>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="6">
Stress test the HTTP load balancer
</ql-activity-tracking></p>
<ol start="13">
<li>In the Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>Network Services</strong> &gt; <strong>Load balancing</strong>.</li>
<li>Click <strong>http-lb</strong>.</li>
<li>Click <strong>Monitoring</strong>.</li>
<li>Monitor the <strong>Frontend Location (Total inbound traffic)</strong> between North America and the two backends for a couple of minutes.</li>
</ol>
<ql-infobox><strong>Note: </strong>At first, traffic should just be directed to <b>us-1-mig</b>, but as the RPS increases, traffic is also directed to <b>europe-1-mig</b>. This demonstrates that by default traffic is forwarded to the closest backend, but if the load is very high, traffic can be distributed across the backends.</ql-infobox>
<p><img alt="Traffic flow diagram" src="https://cdn.qwiklabs.com/VXed3INdoPqLPZvmrtV4QWitOBU55CbpYWMUvs%2BM%2BmE%3D"></p>
<ol start="17">
<li>In the Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" title="Navigation menu">), click <strong>Compute Engine</strong> &gt; <strong>Instance groups</strong>.</li>
<li>Click on <strong>us-1-mig</strong> to open the instance group page.</li>
<li>Click <strong>Monitoring</strong> to monitor the number of instances and LB capacity.</li>
<li>Repeat the same for the <strong>europe-1-mig</strong> instance group.</li>
</ol>
<ql-infobox><strong>Note: </strong>Depending on the load, you might see the backends scale to accommodate the load.
</ql-infobox>
<h2 id="step8">Task 7. Review</h2>
<p>In this lab, you configured an HTTP load balancer with backends in us-central1 and europe-west1. Then you stress-tested the load balancer with a VM to demonstrate global load balancing and autoscaling.</p>
<h2 id="step9">End your lab</h2>
<p>When you have completed your lab, click <strong>End Lab</strong>. Qwiklabs removes the resources you’ve used and cleans the account for you.</p>
<p>You will be given an opportunity to rate the lab experience. Select the applicable number of stars, type a comment, and then click <strong>Submit</strong>.</p>
<p>The number of stars indicates the following:</p>
<ul>
<li>1 star = Very dissatisfied</li>
<li>2 stars = Dissatisfied</li>
<li>3 stars = Neutral</li>
<li>4 stars = Satisfied</li>
<li>5 stars = Very satisfied</li>
</ul>
<p>You can close the dialog box if you don't want to provide feedback.</p>
<p>For feedback, suggestions, or corrections, please use the <strong>Support</strong> tab.</p>
<p>Copyright 2022 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>

</div>
</div>


<div class='lab-content__end-lab-button js-end-lab-button-container hidden'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
</div>
<div aria-label='Lab Table of Contents' class='outline-container' id='js-outline-container' role='navigation'>
<ul class='lab-content__outline js-lab-content-outline'>
<li><a href="#step1">Overview</a></li><li><a href="#step2">Task 1. Configure a health check firewall rule</a></li><li><a href="#step3">Task 2. Create a NAT configuration using Cloud Router</a></li><li><a href="#step4">Task 3. Create a custom image for a web server</a></li><li><a href="#step5">Task 4. Configure an instance template and create instance groups</a></li><li><a href="#step6">Task 5. Configure the HTTP load balancer</a></li><li><a href="#step7">Task 6. Stress test the HTTP load balancer</a></li><li><a href="#step8">Task 7. Review</a></li><li><a href="#step9">End your lab</a></li>
</ul>
</div>
</ql-drawer-content>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<ql-snackbar id='alert-snackbar'></ql-snackbar>



</div>
</main>

<span class='hidden' id='flash-sibling-before'></span>
<ql-snackbar></ql-snackbar>

<script data-glue-cookie-notification-bar-category='2B' src='https://www.gstatic.com/glue/cookienotificationbar/cookienotificationbar.min.js'></script>

<ql-dialog headline='Score Details' icon='task_alt' id='jupyter-feedback-modal'>
<iframe id='jupyter-feedback-frame' srcdoc='' title='Jupyter Feedback'></iframe>
</ql-dialog>

<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='modal-content mdl-shadow--24dp'>
<div class='modal-body'>
<p class='l-mbm'>
In this lab, you configure an HTTP Load Balancer. Then, you stress test the Load Balancer to demonstrate global load balancing and autoscaling.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
120m access
&middot;
60m completion
</p>
<p class='small-label l-mbs'>
<strong>AWS Region:</strong>
[] <strong></strong>
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>introductory</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://googlecoursera.qwiklabs.com/catalog_lab/2044">https://googlecoursera.qwiklabs.com/catalog_lab/2044</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix' tabindex='-1' title='modal'></iframe>
</div>
<ql-dialog headline='How satisfied are you with this lab?&lt;span aria-hidden=&quot;true&quot;&gt;*&lt;/span&gt;' id='lab-review-dialog'>
<form class="simple_form js-lab-review-form" id="new_lab_review" action="/lab_reviews" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" autocomplete="off" /><div aria-labelledby='lab-review-dialog' aria-required='true' aria-valuemax='5' aria-valuemin='0' aria-valuenow='0' class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='0' id='lab-review-rateit' role='slider' tabindex='0'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" value="12197799" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" value="2044" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" autocomplete="off" type="hidden" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Additional Comments</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</form><ql-button disabled id='submit' label='Submit' slot='action' text></ql-button>
</ql-dialog>

<ql-dialog headline='All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?' icon='error_outline' id='js-lab-are-you-sure-dialog'>
<ql-button id='js-are-you-sure-button' label='Submit' slot='action' text></ql-button>
</ql-dialog>


<script>
  $(function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.chat.init();
  ql.jumpContent.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabReviewTranslations( {"star_amount_1":"1 of 5 stars","star_amount_2":"2 of 5 stars","star_amount_3":"3 of 5 stars","star_amount_4":"4 of 5 stars","star_amount_5":"5 of 5 stars"} )
  ql.labAssessment.init();
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

